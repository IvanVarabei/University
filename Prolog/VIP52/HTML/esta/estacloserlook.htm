<html>

<head>
<title>ESTA - a closer look</title>


<meta name="Microsoft Theme" content="prolog2 010, default">
<meta name="Microsoft Border" content="t, default">
</head>

<body stylesrc="http://carsten-c2/esta/standard_page.htm" bgcolor="#FFFFFF" text="#333333" link="#0000FF" vlink="#008080" alink="#00FFFF"><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td><!--mstheme--><font face="verdana, Arial, Helvetica">
<script language="JavaScript">var toRoot="../";</script>
<script language="JavaScript" src="../vipmenu/js/pdcbar.js"></script>
<script language="JavaScript" src="../vipmenu/js/pdcbardef.js"></script>


<!--mstheme--></font><table class="scrElem" border="0" width="853" height="122">
  <tr>
     <td background="../vipmenu/images/topbar-alt.gif" nowrap valign="top" ><!--mstheme--><font face="verdana, Arial, Helvetica">
                  <blockquote>
                    <blockquote>
                      <blockquote>
                        <blockquote>
                          <blockquote>
                            <blockquote>
                              <blockquote>
                  <p>
                      <strong>
                    
                      <font size="2">
                    
                      <br>
                      <br>
                      <br>
                      <br>
                      </font>
                        <a href="../vipmenu/navigationbar.htm">
                      <font size="2"><br>
                      Navigation&nbsp; without Java Scripts</font></a></strong>
                 </p>
                              </blockquote>
                            </blockquote>
                          </blockquote>
                        </blockquote>
                      </blockquote>
                    </blockquote>
                  </blockquote>
     <!--mstheme--></font></td>
  </tr>
</table><!--mstheme--><font face="verdana, Arial, Helvetica">
</html>
<!--mstheme--></font></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><!--msnavigation--><td valign="top"><!--mstheme--><font face="verdana, Arial, Helvetica">

<h1><!--mstheme--><font color="#000000">Introduction to ESTA<!--mstheme--></font></h1>

<!--mstheme--></font><!--msthemelist--><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica"><a href="#how to write knowledge bases in esta">How to write Knowledge bases in ESTA</a><!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica"><a href="#knowledge representation in esta">Knowledge Representation in ESTA</a><!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica"><a href="#sections">ESTA Sections</a><!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica"><a href="#parameters">ESTA Parameters</a><!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica"><a href="#esta in action">ESTA in action</a><!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica"><a href="help/pdcindex.htm">Full on-line Help</a><!--mstheme--></font><!--msthemelist--></td></tr>
<!--msthemelist--></table><!--mstheme--><font face="verdana, Arial, Helvetica">

<h2><!--mstheme--><font color="#000000"><a name="How to write Knowledge bases in ESTA">How to write Knowledge bases in ESTA</a><!--mstheme--></font></h2>

<p>ESTA is fully exploits Microsoft Windows,&nbsp; making use of the Multiple Document
Interface (MDI), DDE communication with other Windows applications, links into the Windows
help system for hypertext extensions, and sophisticated integration of Windows bitmaps and
metafiles for knowledge representation. The result is a pleasant, user-friendly interface
that is exceptionally easy for those consulting your knowledge bases.</p>

<p>Plus, all language-specific parts of ESTA are recorded in specific files that let you
easily make your own version of ESTA in any language with a minimum of effort.</p>

<p>ESTA includes provisions for generating license free, consultation-only versions of the
system, which may be distributed to end-users.</p>

<p>In addition to knowledge representation, ESTA includes useful features from traditional
programming languages, such as procedure calls and mathematical functions.</p>

<p>ESTA is configurable - menus, startup-pictures, and other UI-functionality can be
readily customized to match the specific needs of your application..</p>

<p>ESTA includes facilities for the knowledge base to call general purpose routines
written in Visual Prolog and (thereby) also routines written in C or other languages.</p>

<p>ESTA has facilities to explain why a question is being asked or why an answer has been
given, or to repeat advice given earlier in a consultation. Of course ESTA also enables
the user to break off a dialog, change the answer to a previously asked question, or bring
up new questions (which have not yet been asked) to answer.</p>

<p>ESTA provides the knowledge engineer with a number of views of the knowledge, including
hierarchical tree-representation, where clicking on a node in the tree brings up an edit
window containing the corresponding rules.</p>

<p>The knowledge entered into ESTA is automatically translated and syntax checked, and
errors are pointed out directly in the text. Furthermore ESTA has a check-facility for
noting type errors, endless loops, undefined or unused knowledge.</p>

<p>ESTA is also available in text mode DOS and OS/2 versions. The knowledge bases can be
converted between the Windows and text mode version - thus it is possible to have the same
knowledge base available for DOS, OS/2 and Windows users. (Pictures and Windows specific
features like DDE etc. are not portable.)</p>

<h3><!--mstheme--><font color="#000000"><a name="Knowledge Representation in ESTA">Knowledge Representation in ESTA</a><!--mstheme--></font></h3>

<p>In ESTA, knowledge is represented in an intuitive way - rules are written in
English-like statements as &quot;if its_raining and person_has_umbrella advice 'You can go
out' &quot;</p>

<p>A knowledge base in ESTA consists of Sections and Parameters. The sections contains the
rules (the logic) that directs the user to the right place in the knowledge base and gives
the appropriate advice.</p>

<p>Parameters are the variables that can obtain values - 'its_raining' or
'person_has_umbrella' are examples of parameters that can either be true, false or
unknown. Other parameter-types are texts, numbers or categories. Parameter definitions can
themselves contain rules and thus their values can be based on other parameters.</p>

<p>A knowledge base in ESTA has a hierarchical structure and could look like this:</p>

<p><a href="images/estatree.gif"><img src="images/estatree_small1.gif" alt="estatree.gif (16691 bytes)" width="100" height="75"></a></p>

<h3><!--mstheme--><font color="#000000"><a name="Sections">Sections</a><!--mstheme--></font></h3>

<p>Sections contain the rules that tell ESTA how to solve the problem and which actions to
perform, such as giving advice, going to other sections, calling special routines,
chaining to other knowledge bases, etc. </p>

<p>Each section can be edited individually in a text window. The first section in a
knowledge base must be called 'start', and this is the place where ESTA begins the
consultation. The 'do' command executes another section, thus 'do overheating' will
execute the overheating Section.</p>

<blockquote>
  <p><code>section start : 'main section'<br>
  if (problem='starting_problem') do starting_problem<br>
  if (problem='overheating') do overheating<br>
  if (problem='smell_of_gasoline') do smell_of_gasoline<br>
  if (problem='vibration') do vibration<br>
  do other<br>
  <br>
  section overheating 'the engine gets overheated'<br>
  advice 'Overheating is normally caused by problems in the cooling system'<br>
  if not(water_ok) advice<br>
  &nbsp; 'Top up your radiator but keep an eye on the<br>
  &nbsp;&nbsp; water level as there might be a leak in the system'<br>
  if water_ok and acceleration_noise advice<br>
  &nbsp; 'The fan belt may be slipping. Tighten it up.'<br>
  if water_ok and not(acceleration_noise) and not(oil_ok) advice<br>
  &nbsp; 'Top up the oil in your ' car '. In future, watch the oil level carefully'<br>
  &nbsp; 'as it is cheaper to buy new oil than a new engine</code></p>
</blockquote>

<p>During the consultation the 'advice' command will supply the user with advice in this
way:</p>

<p><a href="images/advice.gif"><img src="images/advice_small.gif" alt="advice.gif (6152 bytes)" width="100" height="50"></a></p>

<p>Should you wish to know how the system reached a certain conclusion or why a certain
piece of advice is given, you click on the 'Why' button and the system is able to
establish why the conclusion was reached based on the rules used.</p>

<p><a href="images/why.gif"><img src="images/why_small.gif" alt="why.gif (7047 bytes)" width="100" height="50"></a></p>

<h3><!--mstheme--><font color="#000000"><a name="Parameters">Parameters</a><!--mstheme--></font></h3>

<p>A Parameter is a variable that can have a value (text, number, true/false, or one of a
number of options). The value can be calculated from other parameters or specified by the
end-user (when ESTA needs the value, and asks for it)</p>

<p>A typical parameter might be defined as shown below, with entries to specify the
question to be asked, an explanation to give if the user presses the 'explain' button, the
possible values, and even links to a graphic representation . Expressions can be given to
calculate the parameter from other parameters, the range can be given etc.</p>

<blockquote>
  <p><code>parameter car 'the kind of car'<br>
  type category<br>
  explanation<br>
  &nbsp; 'identify your car with one of the listed types as closely as you can.'<br>
  option<br>
  &nbsp; ambulance<br>
  &nbsp; policecar<br>
  &nbsp; sedan - 'car'<br>
  &nbsp; van.<br>
  question 'Which kind of car do you have ?'<br>
  picture 'cars'</code></p>
</blockquote>

<h3><!--mstheme--><font color="#000000">Name<!--mstheme--></font></h3>

<p>When a parameter is declared, it is necessary to specify the name of the parameter
(e.g. 'car') this name is used when the parameter is referred to in rules.</p>

<h3><!--mstheme--><font color="#000000">Type<!--mstheme--></font></h3>

<p>A Parameter has one of the following four types:</p>

<!--mstheme--></font><!--msthemelist--><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">Boolean (true, false or unknown)<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">Number ( integers or reals)<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">Text (such as a person's name, etc.)<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">Category (used when the parameter is known to take one of a definite set of values).<!--mstheme--></font><!--msthemelist--></td></tr>
<!--msthemelist--></table><!--mstheme--><font face="verdana, Arial, Helvetica">

<h3><!--mstheme--><font color="#000000">Question<!--mstheme--></font></h3>

<p>ESTA determines if and when it needs the value of a parameter. If the value depends on
other parameters it will calculate the value otherwise it will prompt the user for the
value. ESTA generates a dialog box and asks the question given in the parameter definition
under the 'question' heading. </p>

<p><a href="images/question.gif"><img src="images/question_small.gif" alt="question.gif (5855 bytes)" width="100" height="113"></a></p>

<h3><!--mstheme--><font color="#000000">Explanation<!--mstheme--></font></h3>

<p>When a question is given during a consultation, the user will have the option to ask
ESTA to 'explain the question'. This explanation can be provided by the knowledge engineer
in the 'explanation' field of a parameter declaration. In the dialog it will appear like
this:</p>

<p><a href="images/explain.gif"><img src="images/explain_small.gif" alt="explain.gif (8013 bytes)" width="100" height="50"></a></p>

<p>You can also answer 'Unknown' to a question posed by ESTA if you are unaware of the
value of the parameter. This can either lead to special advice or to a dialog which will
establish the value by other rules.</p>

<h3><!--mstheme--><font color="#000000">Option<!--mstheme--></font></h3>

<p>The Option field is used in parameters of Category type only. After giving the keyword
Options, a list of values can be given, and a menu is automatically generated during the
consultation. The user may select from the menu by clicking on the appropriate option.</p>

<h3><!--mstheme--><font color="#000000">Picture<!--mstheme--></font></h3>

<p>Pictures can be included as part of advice, questions or explanations. When used
together with category parameters, it is even possible to define links between areas of a
picture and specific parameter options, so the user can answer a category-based query by
pointing at regions of a graphic and clicking.</p>

<h1><!--mstheme--><font color="#000000"><a name="ESTA in action">ESTA in action</a><!--mstheme--></font></h1>

<p>To show the power and ease of use of ESTA, this article will take you through a
complete expert system development project. A number of aspects are covered: </p>

<!--mstheme--></font><!--msthemelist--><table border="0" cellpadding="0" cellspacing="0" width="100%">
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">How to model the real world using ESTA's knowledge representation<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">How to extend ESTA with your own functionality coded in Visual Prolog<!--mstheme--></font><!--msthemelist--></td></tr>
  <!--msthemelist--><tr><td valign="baseline" width="42"><img src="_themes/prolog2/modbul1a.gif" width="14" height="13" hspace="14"></td><td valign="top" width="100%"><!--mstheme--><font face="verdana, Arial, Helvetica">How to integrate ESTA with other applications to take full advantage of the Windows
    environment.<!--mstheme--></font><!--msthemelist--></td></tr>
<!--msthemelist--></table><!--mstheme--><font face="verdana, Arial, Helvetica">

<p>We want to build a financial expert system for use in a bank. The bank customer should
be able to use the system to find out what kind of loan the bank can offer him to best
suit his needs. </p>

<p>We'll show how such an expert system can be built using ESTA, in other words, how the
expert knowledge is easily represented.</p>

<p>Then, as our demands on the system grow, we will make it increasingly sophisticated,
first by linking it to other Windows applications using DDE (Dynamic Data Exchange) and
secondly by programming our own extensions to ESTA in Visual Prolog.</p>

<h3><!--mstheme--><font color="#000000">Knowledge Acquisition: The Bank Case<!--mstheme--></font></h3>

<p>We will start out by describing the problem that we want the expert system to solve.
This process is often called 'knowledge acquisition', where we seek to extract some of the
rules used.</p>

<p>To decide which loan the customer qualifies for, the bank calculates a risk_factor for
the customer. The bigger this factor is, the bigger is the risk. Thus a negative
risk_factor is desirable - where a risk factor of zero is the average risk - below zero is
a low risk, and above zero is a high risk. </p>

<p>The risk can depend on several criteria such as personal income, age, the amount of
disposable income after tax etc. The risk factor is calculated using this formula:</p>

<blockquote>
  <p><code>(200000-gross income) +<br>
  (5000-available amount)*12 +<br>
  (5-years employed)*1000 + <br>
  agefactor +<br>
  150000 if self employed.</code></p>
</blockquote>

<p>The available amount is the amount available after tax, housing, food and other
expenses. Years employed is the number of consecutive years in the current line of work.
The variable age factor is calculated based on the formula:</p>

<blockquote>
  <p><code>100000 if age&lt;20,<br>
  40000 if age&gt;=20 and age&lt;50,<br>
  70000 íf age&gt;=50</code></p>
</blockquote>

<p>The risk factor, together with other variables is used to determine which loan a
customer can have. The bank has these 6 loan types:</p>

<p>The Loans</p>

<p>A - the super-duper loan with very low interest (12 %)</p>

<blockquote>
  <p>Risk factor &lt;-200000</p>
  <p>Max amount 100000</p>
  <p>Not for real estate</p>
</blockquote>

<p>For customers with at least two other accounts with the bank </p>

<p>B - The cheap car loan with no down payment (12.5%)</p>

<blockquote>
  <p>Risk factor &lt;-100000</p>
  <p>Max 7 years pay back</p>
  <p>At least one other account with the bank</p>
</blockquote>

<p>C - the cheap car loan with a 30 % down payment (12.5 %)</p>

<blockquote>
  <p>Max 7 years</p>
  <p>Risk factor &lt;-50000</p>
  <p>D - the not-so-cheap car loan with no down payment (14.5 %)</p>
  <p>Risk factor &lt;=0</p>
  <p>max 8 years</p>
</blockquote>

<p>E - The real-estate loan (11.5 %)</p>

<blockquote>
  <p>Risk factor&lt;-50000</p>
  <p>not (self employed)</p>
</blockquote>

<p>F - the &quot;normal&quot;, pretty-high-interest loan for anything you wish (16 %)</p>

<blockquote>
  <p>Risk factor &lt;50000</p>
  <p>Max amount: 25000</p>
</blockquote>

<p>The loan type F can be used for anything including cars and real-estate.</p>

<h3><!--mstheme--><font color="#000000">1st Version; The basic knowledge base<!--mstheme--></font></h3>

<p>As our first version of the expert system we make a simple ESTA knowledge base that
simply tells the customer what kind of loan he can have based on his personal data.</p>

<p>For our bank's system, the start section looks like this:</p>

<blockquote>
  <p><code>section start : 'start'<br>
  if risk_factor&gt;= 50000<br>
  advice 'Risk factor is too high - we cannot give you any loans',<br>
  if loan_amount&lt;=100000 and risk_factor&lt;-200000 and<br>
  not(use='real_estate') advice<br>
  'Congratulations - you qualify for the Super-Duper cheap A-loan',<br>
  if use='car' do car_section<br>
  if use='real_estate' do real_estate_section<br>
  if use='other' or not(loan_found) do other_section<br>
  If the 'risk_factor' parameter is above 50000 no loans can be given - this 'advice' is
  given and the start section terminates at the quit statement.</code></p>
</blockquote>

<p><a href="images/image37.gif"><img src="images/image37_small1.gif" alt="image37.gif (5561 bytes)" width="100" height="42"></a></p>

<p>The 'risk_factor' parameter has the following definition:</p>

<p>parameter risk_factor : 'Risk factor'</p>

<p>type number</p>

<p>rules</p>

<p>(200000-gross_income) + (5000-available_amount)*12 + (5-years_employed)*1000 +
agefactor -150000 if self_employed,</p>

<p>(200000-gross_income) + (5000-available_amount)*12 + (5-years_employed)*1000 +
agefactor.</p>

<p>The first rule deals with the self employed person and the second one deals with the
not self employed person. The parameters 'gross_income', 'available_amount',
'years_employed' and 'self_employed' are entered by the end-user (the bank customer). The
parameter definitions look like this:</p>

<p>parameter gross_income : 'Gross income'</p>

<p>type number</p>

<p>explanation 'The gross income is the total income before tax'</p>

<p>question 'What is your gross income per year ?'</p>

<p>When ESTA needs the value this question is asked:</p>

<p><a href="images/image38.gif"><img src="images/image38_small1.gif" alt="image38.gif (5202 bytes)" width="100" height="68"></a></p>

<p>The 'agefactor' parameter is based on the parameter 'age' which is also typed in by the
customer. </p>

<p>When ESTA starts evaluating the start section and gets to the line:</p>

<p>if risk_factor&gt;50000</p>

<p>The parameter 'risk_factor' has no value - hence it goes to the definition of the
parameter to find out how to give it a value. In the definition it finds references to
other parameters with no value (yet) and in turn goes to their definitions to find out how
they should obtain a value. ESTA starts asking for the values of certain parameters in
order to give 'risk_factor' a value - so the beginning of the dialog can go like this:</p>

<p>Are you self employed ?</p>

<p>No</p>

<p>What is your gross income per year ?</p>

<p>300000</p>

<p>What is the available amount per month ?</p>

<p>6000</p>

<p>How many years have you been employed ?</p>

<p>7</p>

<p>What is your age ?</p>

<p>27</p>

<p>The basic strategy is to find the cheapest loan a customer qualifies for. In the start
section, the parameter use holds the item the customer wants to use the money for. This
can be either 'car', 'real estate' or 'other'. There is a section for each item. If the
'car_section' or the 'real_estate_section' section doesn't yield any results the
'other_section' is tried to see whether any of the non-specific loans can be used. We
check for the SuperDuper loan before anything else if the loan isn't for real estate,
because the SuperDuper loan is cheaper than any of the other loans. </p>

<p>The 'car_section' looks like this:</p>

<p>section car_section : 'The car loans'</p>

<p>if risk_factor&lt;-100000 and min_years&lt;=7 and other_engagements&gt;=1 </p>

<p>advice ' cheap car loan B with no down payment' </p>

<p>if risk_factor&lt;-50000 and min_years&lt;=7 and down_payment_30</p>

<p>advice 'cheap car loan C with 30 % down payment'</p>

<p>if risk_factor&lt;=0 and min_years&gt;=8 and not(down_payment_30)</p>

<p>advice 'the not-so-cheap car loan D with no down payment'</p>

<p>The parameter 'min_years' holds the minimum pay back period acceptable for the
customer, the parameter 'down_payment_30' is true if the customer can give a 30% down
payment on the car. </p>

<p>We have now made an advisory system that tells a customer what loan he can have based
on his personal data. </p>

<p>The system does not deal with the problem of whether the customer can actually afford
payments on the loan. For this we need to be able to calculate the monthly payment for a
specific loan type, based on the loan-amount, the number of payments, and the interest
rate. This and other enhancements will be implemented in the 2nd version.</p>

<h3><!--mstheme--><font color="#000000">2nd. Version; Integrated with Microsoft Excel<!--mstheme--></font></h3>

<p>In the next version of the expert system we will use Excel as our financial calculator
and let the customer make his own what-if analysis- chart drawing etc. The customer can
use Excel to answer questions like:</p>

<blockquote>
  <p>· What if I change the pay back period from 5 to 4 years - how does that effect the
  monthly payment and the total interest paid?</p>
  <p>· What if the interest rate drops from 14 to 13 %?</p>
  <p>· What if I raise the monthly payment by 500 ...</p>
</blockquote>

<p>The first change to the system is that we want it to detect whether the customer can
afford the cheapest loan he qualifies for. If not, there is no purpose in trying other
more expensive loan types.</p>

<p>When the system has detected the cheapest possible loan type for which the customer
qualifies, it will check whether the customer is able to pay this loan. We do this by
calling the section 'check_loan' - here in a part from the 'car_section'</p>

<p>if risk_factor&lt;-100000.0 and min_years&lt;=7 and other_accounts&gt;=1 </p>

<p>( assign interest:=12.5,</p>

<p>assign min_months:=84,</p>

<p>assign loan_type:='B',</p>

<p>do check_loan,</p>

<p>quit)</p>

<p>The section 'check_loan' is coded using the DDE-interface (see the article
&quot;Integrating ESTA with other Windows application&quot;). For each loan type we have
defined a separate spreadsheet. The figures below show a fraction of one of these
spreadsheets:</p>

<p><a href="images/image39.gif"><img src="images/image39_small1.gif" alt="image39.gif (5737 bytes)" width="100" height="81"></a></p>

<p>The calculated payment (C14) is based on the ''loan_amount', the annual interest rate
and the term in years and payments per year. ESTA sends the appropriate data to the
spreadsheet via the DDE interface as described later in this article. This is done in a
modified version of the section 'check_loan':</p>

<p>section check_loan : 'Checking the loan'</p>

<p>assign CH:=dde_initiate(&quot;excel&quot;,&quot;Sheet1&quot;)</p>

<p>do load_sheet</p>

<p>call dde_poke_number(CH,&quot;R7C3&quot;,loan_amount) </p>

<p>call dde_poke(CH,&quot;R8C3&quot;,interest)</p>

<p>call dde_poke_number(CH,&quot;R9C3&quot;,years)</p>

<p>assign monthly_payment1:=text_number(dde_request(CH,&quot;R14C3&quot;))</p>

<p>call dde_terminate(CH)</p>

<p>if monthly_payment1&gt;(available_amount-1000)</p>

<p>( advice 'sorry - no loans.',</p>

<p>quit)</p>

<p>advice 'You can have loan ' loan_type ' Go to Excel to make calculations'</p>

<p>The parameter 'loan_amount' is input by the customer. The section 'load_sheet' loads
the proper spreadsheet according to the loan type. The values are put in the spreadsheet
(with 'dde_poke' and the special numeric version 'dde_poke_number'). The monthly payment
is retrieved using 'dde_request' (and text_number because 'dde_request' always returns a
string). </p>

<p>This version of the expert system relies on Excel to make specialized calculations used
by the system. This requires Excel to be present every time the system is used. In the 3rd
version we extend ESTA with a similar financial function, however, this time coded
directly in Visual Prolog.</p>

<h3><!--mstheme--><font color="#000000">3rd. Version; Programming a New ESTA Function in Visual Prolog<!--mstheme--></font></h3>

<p>Now we want to extend ESTA with functionality coded in Visual Prolog. The third version
of the expert system is an alternative to second one. Instead of using Excel we want to
make our own function called pmt to calculate monthly payment for a loan. The function
pmt(Interest,Months,Loan_amount) returns the monthly payment for a loan with constant
monthly payments and a constant interest rate. The mechanics of this are described later
in this article, here we simply show how the new function alters our previous definition
of check_loan. </p>

<p>Now we can calculate whether the customer can use the cheapest loan type he qualifies
for as follows:</p>

<p>section check_loan</p>

<p>If pmt(interest,min_months,loan_amount)&lt;(available_amount-1000) </p>

<p>( advice ´sorry - you don't have enough money available ',</p>

<p>'for the desired size of the loan´,</p>

<p>quit)</p>

<p>advice ´You qualify for the loan of type´ loan_type</p>

<h3><!--mstheme--><font color="#000000">Interfacing ESTA with other Windows Applications:<!--mstheme--></font></h3>

<p>DDE (Dynamic Data Exchange) is a Windows protocol that lets applications talk to each
other. ESTA supports DDE which means that you can interface ESTA to all other applications
that support DDE - thus you can have your expert system controlling spread-sheets, word
processors and database-systems. You can send data to these applications, you can retrieve
information from them, and you can even execute commands in the applications.</p>

<p>The Windows version of ESTA has a DDE interface which is very similar to that of the
macro languages in Word and Excel. ESTA can establish one or more conversations with DDE
servers. A conversation is created with the function dde_initiate(Application, Topic)
which returns a channel-number used to identify the conversation. Application is the name
of the server application and Topic is the topic of the conversation - often a file name
or a keyword accepted by the server. </p>

<p>The procedure dde_execute(Channel, Command) sends the commands in Command to the server
for execution. Channel is the Number returned from 'dde_initiate'.</p>

<p>The procedure dde_poke(Channel,Item,Data) sends Data to the server. Item specifies the
destination - Item is a server specific entity - in Excel, for example, Item could be a
specific spread sheet cell, thus dde_poke(CH,&quot;R1C1&quot;,&quot;12&quot;) would send
the number 12 to the cell A1. </p>

<p>The function dde_request(Channel,Item) is used to retrieve a data-item from the server.
dde_terminate(Channel) and dde_terminate_all terminate one specific or all conversations,
respectively. </p>

<p>In the following example, a conversation is opened with Excel using the spreadsheet
file 'file_a.xls'. The value 546 is sent to the cell R2C4 (D2) - the file 'file_b.xls' is
opened using the Excel OPEN command, and the value of R1C1 (A1) is returned. </p>

<p>CH = dde_initiate(&quot;excel&quot;,&quot;file_a.xls&quot;)</p>

<p>dde_poke(CH,&quot;R2C4&quot;,&quot;546&quot;)</p>

<p>dde_execute(CH,&quot;[OPEN(file_b.xls)]&quot;)</p>

<p>VAL = dde_request(CH,&quot;R1C2&quot;)</p>

<p>dde_terminate(CH)</p>

<p>See the &quot;Tips &amp; Tricks&quot; article for the details on how the DDE interface
is implemented in Visual Prolog.</p>

<h3><!--mstheme--><font color="#000000">Extending ESTA with Visual Prolog<!--mstheme--></font></h3>

<p>With Visual Prolog you can define your own procedures and functions in ESTA. These
specially tailored procedures and functions can be used in ESTA sections and parameters
like any other procedures or functions. All you have to do is to define the procedure or
function in the file WINEINTF.PRO and compile this file to EXE - then you have a new
version of ESTA with your own functionality built into the ESTA language.</p>

<h3><!--mstheme--><font color="#000000">Procedures<!--mstheme--></font></h3>

<p>A procedure is a piece of code that is executed by the call statement in an ESTA
section. As an example we will make a simple procedure that shows the text X in Windows
message box with the heading Y. The procedure has two arguments, both strings, or phrases
as they are called in ESTA. In WINEINTF.PRO we add this clause to define the procedure:</p>

<p>proc_descr(my_msg,2,[phrase,phrase]):-!.</p>

<p>This clause reads: the user defined procedure 'my_msg' has two parameters; a phrase and
a phrase. The following clause gives the code for the procedure:</p>

<p>eval_proc(my_msg,[str(X),str(Y)]):-!,</p>

<p>MB_msg = mb_ok + mb_iconexclamation,</p>

<p>MessageBox(0,X,Y,MB_msg),!.</p>

<p>This procedure simply calls the Windows function MessageBox. You can call any Windows
function or Visual Prolog predicate in the procedure. You can even call a number of
ESTA´s own internal predicates to manipulate the ESTA user interface at run-time. </p>

<h3><!--mstheme--><font color="#000000">Functions<!--mstheme--></font></h3>

<p>ESTA supports functions in the usual sense - procedures that return a value. Both
built-in and user-defined functions can be used in sections and parameters alike. Let's
define the function 'check_sum(A,B,C)'. This function returns the checksum of A, B and C
which in our example is:</p>

<p>(A + 2*b + 3*C) mod 11</p>

<p>The definition of 'check_sum' is:</p>

<p>func_descr(check_sum,3,[number,number,number],number)</p>

<p>The function has 3 arguments which are all numbers and it returns a value which is a
number. The clause for the function looks like this:</p>

<p>eval_func(check_sum,[A,B,C],float(Result)):- </p>

<p>number_real(A,A1),number_real(B,B1),number_real(C,C1),</p>

<p>Num = A1 + B1 * 2 + C1 * 3,</p>

<p>Num_int = cast(unsigned,Num),</p>

<p>Result = Num_int mod 11,!. </p>
&nbsp;<!--mstheme--></font><!--msnavigation--></td></tr><!--msnavigation--></table></body>
</html>
